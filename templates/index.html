<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Object Classification — Rayhan</title>
  <!-- Bootstrap CDN -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <style>
    :root{
      --bg1:#0f1724; /* deep navy */
      --accent-a:#6dd3ff; /* soft cyan */
      --accent-b:#8b5cf6; /* violet */
      --accent-c:#ff7ab6; /* pink */
      --card:#0b1220; /* darker card */
      --muted:#b6c7d8;
    }
    html,body{height:100%;}
    body{margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;background: linear-gradient(135deg,var(--bg1), #071028 70%);color:var(--muted);min-height:100vh;display:flex;flex-direction:column}

    main.container{max-width:1100px;margin:48px auto}
    .card-app{border-radius:14px;border:0;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));box-shadow:0 12px 40px rgba(2,6,23,0.5);overflow:visible}

    header .title{color:white}
    .profile-chip{display:flex;align-items:center;gap:10px;background:linear-gradient(90deg,var(--accent-a),var(--accent-b));padding:6px 10px;border-radius:999px;color:#031026;box-shadow:0 8px 24px rgba(13,20,30,0.5)}

    .preview-box{height:320px;width:100%;max-width:420px;position:relative;border-radius:12px;display:flex;align-items:center;justify-content:center;overflow:hidden;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
    .preview-box img,.preview-box video{max-height:100%;max-width:100%;display:block;border-radius:8px;transition:transform .45s cubic-bezier(.2,.9,.2,1)}
    .preview-box:hover img{transform:scale(1.03)}

    .controls .btn{border-radius:10px;transition:transform .12s ease, box-shadow .12s ease}
    .gradient-btn{background:linear-gradient(90deg,var(--accent-b),var(--accent-c));color:white;border:0;box-shadow:0 10px 30px rgba(139,92,246,0.18)}

    .card-floating{animation:floaty 6s ease-in-out infinite}
    @keyframes floaty {0%{transform:translateY(0px)}50%{transform:translateY(-6px)}100%{transform:translateY(0px)}}

    .result-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03)}
    .result-title{color:var(--accent-a);font-weight:700}
    .result-list{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .result-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.012),rgba(255,255,255,0.006));}

    footer.site-footer{margin-top:36px;padding:18px 0;color:rgba(255,255,255,0.7);text-align:center;font-size:14px}

    .file-input{position:relative;overflow:hidden}
    .file-input input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer}

    @media(min-width:768px){.preview-col{display:flex;align-items:flex-start}}
  </style>
</head>
<body>
  <main class="container">
    <div class="card p-4 card-app card-floating">
      <header class="d-flex align-items-center justify-content-between mb-3">
        <div>
          <h1 class="h4 mb-0 title">Object Classification</h1>
          <div class="small text-muted">Fast. Clean. Personal.</div>
        </div>

        <div class="profile-chip">
          <div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent-a),var(--accent-b));display:flex;align-items:center;justify-content:center;color:#021"><strong>R</strong></div>
          <div style="font-size:14px;font-weight:600">Rayhan Hussain</div>
        </div>
      </header>

      <div class="row">
        <!-- Left: preview / upload -->
        <section class="col-md-6 preview-col mb-3">
          <div class="w-100 d-flex flex-column align-items-center">
            <div class="preview-box mb-3" id="previewBox" aria-live="polite">
              <img id="previewImage" alt="Preview of uploaded image" src="" style="display:none">
              <video id="previewVideo" autoplay playsinline muted style="display:none"></video>
              <div id="placeholder" class="text-center" style="color:rgba(255,255,255,0.6)">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 8h10M7 12h4" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" opacity=".9"/></svg>
                <div class="mt-2">No image selected</div>
              </div>
            </div>

            <div class="w-100 controls">
              <div class="d-flex flex-wrap align-items-center justify-content-between">
                <div class="file-input mr-2 mb-2" style="flex:1 1 200px;">
                  <button id="btnChoose" class="btn btn-outline-light btn-block">Choose Image</button>
                  <input id="fileInput" type="file" accept="image/*" aria-label="Choose image file">
                </div>

                <div class="mb-2" style="flex:0 0 150px;">
                  <button id="btnToggleCam" class="btn btn-outline-light btn-block" aria-pressed="false">Use Camera</button>
                </div>

                <div class="mb-2" style="flex:0 0 150px;">
                  <button id="btnPredict" class="btn gradient-btn btn-block" disabled>Predict</button>
                </div>
              </div>

              <div class="form-group mt-2 mb-0">
                <label for="apiUrl" class="sr-only">Prediction API URL</label>
                <input id="apiUrl" type="url" class="form-control" placeholder="Prediction endpoint (e.g. /predict)" value="../predict" aria-label="Prediction endpoint">
              </div>
            </div>
          </div>
        </section>

        <!-- Right: results -->
        <section class="col-md-6">
          <div class="mb-3">
            <h2 class="h6 text-white">Prediction Results</h2>

            <div class="result-card">
              <div class="d-flex align-items-center justify-content-between">
                <div>
                  <div class="result-title">Top Predictions</div>
                  <div class="small text-muted">Confidence & label</div>
                </div>
                <div id="responseImageContainer" style="width:92px;height:92px;display:flex;align-items:center;justify-content:center;border-radius:8px;background:linear-gradient(90deg,var(--accent-a),var(--accent-b));box-shadow:0 8px 24px rgba(109,211,255,0.06)"></div>
              </div>

              <div class="result-list" id="resultList">
                <div class="result-item" style="color:var(--muted)">No prediction yet <span style="opacity:.6">—</span></div>
              </div>

            </div>

          </div>
        </section>
      </div>

      <div class="d-flex justify-content-end mt-3">
        <div id="loader" class="loader" style="display:none;align-items:center;gap:8px;">
          <div class="spinner-border" role="status" aria-hidden="true"></div>
          <span class="text-white-50">Working…</span>
        </div>
      </div>

    </div>
  </main>

  <footer class="site-footer">
    <div>Copyright © 2025 | Rayhan Hussain - All Rights Reserved</div>
  </footer>

  <script>
    (function(){
      // If your backend isn't available or CORS blocks requests, this flag enables a friendly mock so you can see the UI.
      const MOCK_ON_FAILURE = true;

      const fileInput = document.getElementById('fileInput');
      const previewImage = document.getElementById('previewImage');
      const previewVideo = document.getElementById('previewVideo');
      const placeholder = document.getElementById('placeholder');
      const btnChoose = document.getElementById('btnChoose');
      const btnToggleCam = document.getElementById('btnToggleCam');
      const btnPredict = document.getElementById('btnPredict');
      const apiUrl = document.getElementById('apiUrl');
      const resultList = document.getElementById('resultList');
      const responseImageContainer = document.getElementById('responseImageContainer');
      const loader = document.getElementById('loader');

      let currentBase64 = '';
      let stream = null;

      function showLoader(on){ loader.style.display = on ? 'flex' : 'none'; }
      function resetPreview(){ previewImage.style.display='none'; previewVideo.style.display='none'; placeholder.style.display='flex'; btnPredict.disabled = true; currentBase64 = ''; }
      function showImageFromDataURL(dataURL){ previewImage.src = dataURL; previewImage.style.display='block'; previewVideo.style.display='none'; placeholder.style.display='none'; btnPredict.disabled = false; }

      fileInput.addEventListener('change', async (e)=>{
        if(!e.target.files || !e.target.files[0]) return resetPreview();
        stopCamera();
        const file = e.target.files[0];
        if(!file.type.startsWith('image/')) return alert('Please select an image file.');
        if(file.size > 8 * 1024 * 1024){ if(!confirm('The file is larger than 8MB. Continue?')){ fileInput.value=''; return resetPreview(); } }
        const reader = new FileReader();
        reader.onload = function(ev){ const dataURL = ev.target.result; currentBase64 = dataURL.replace(/^data:image\/[a-zA-Z]+;base64,/, ''); showImageFromDataURL(dataURL); }
        reader.readAsDataURL(file);
      });

      btnChoose.addEventListener('click', ()=>fileInput.click());

      btnToggleCam.addEventListener('click', async ()=>{
        if(stream){ stopCamera(); btnToggleCam.setAttribute('aria-pressed','false'); btnToggleCam.textContent='Use Camera'; return; }
        try{ stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}, audio:false}); previewVideo.srcObject = stream; previewVideo.style.display='block'; previewImage.style.display='none'; placeholder.style.display='none'; btnToggleCam.setAttribute('aria-pressed','true'); btnToggleCam.textContent='Stop Camera'; btnPredict.disabled = false; }catch(err){ console.error(err); alert('Could not access camera — permission denied or no camera available.'); }
      });

      function stopCamera(){ if(!stream) return; stream.getTracks().forEach(t=>t.stop()); stream = null; previewVideo.srcObject = null; previewVideo.style.display='none'; placeholder.style.display='flex'; }

      async function buildPayload(){ if(stream){ const video = previewVideo; const canvas = document.createElement('canvas'); canvas.width = video.videoWidth || 640; canvas.height = video.videoHeight || 480; const ctx = canvas.getContext('2d'); ctx.drawImage(video, 0, 0, canvas.width, canvas.height); const dataURL = canvas.toDataURL('image/jpeg', 0.92); return dataURL.replace(/^data:image\/[a-zA-Z]+;base64,/, ''); } return currentBase64; }

      // Friendly mock response used when backend fails or for demonstration
      function createMockResponse(){
        return new Promise(resolve => {
          setTimeout(()=>{
            resolve({
              predictions: [
                {label:'Person', score:0.93},
                {label:'Dog', score:0.04},
                {label:'Backpack', score:0.02}
              ],
              image: null
            });
          }, 800);
        });
      }

      btnPredict.addEventListener('click', async ()=>{
        const base64 = await buildPayload(); if(!base64){ alert('No image available to send.'); return; }
        const url = (apiUrl.value || '').trim(); if(!url){ alert('Please set the Prediction endpoint URL.'); apiUrl.focus(); return; }

        showLoader(true); resultList.innerHTML = '<div class="result-item">Sending image…</div>'; responseImageContainer.innerHTML = '';
        try{
          const res = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({image: base64}), mode: 'cors' });
          if(!res.ok) throw new Error('Server returned ' + res.status);
          const data = await res.json();
          handlePredictionData(data);
        }catch(err){
          console.warn('Prediction request failed:', err.message);
          if(MOCK_ON_FAILURE){
            const mock = await createMockResponse();
            handlePredictionData(mock);
          }else{
            resultList.innerHTML = `<div class="result-item" style="color:#ffb4c6">Error: ${escapeHtml(err.message)}</div>`;
          }
        }finally{ showLoader(false); }
      });

      function handlePredictionData(data){
        // Accept several shapes: {predictions: [...]}, array, or simple map
        let predictions = [];
        let responseImage = null;
        if(Array.isArray(data)){
          // try to find predictions inside
          if(data[0] && data[0].predictions) predictions = data[0].predictions;
          else predictions = data[0] || [];
          if(data[1] && data[1].image) responseImage = data[1].image;
        }else if(data && typeof data === 'object'){
          predictions = data.predictions || data.results || data.items || [];
          responseImage = data.image || null;
        }

        if(predictions && !Array.isArray(predictions)){
          predictions = Object.keys(predictions).map(k=>({label:k,score:predictions[k]}));
        }

        // fallback
        if(!predictions || predictions.length===0) predictions = [{label:'No confident prediction', score:null}];

        // sort by score desc when possible
        predictions.sort((a,b)=>{ const as = a.score||0; const bs = b.score||0; return bs - as; });

        // render top 5
        const top = predictions.slice(0,5);
        resultList.innerHTML = '';
        top.forEach(p=>{
          const label = escapeHtml(p.label || p.name || (p[0]||'unknown'));
          const score = (typeof p.score === 'number') ? Math.round(p.score*100) + '%' : (p.score ? p.score : '');
          const li = document.createElement('div'); li.className='result-item'; li.innerHTML = `<div style="font-weight:600;color:white">${label}</div><div style="opacity:.85">${score}</div>`; resultList.appendChild(li);
        });

        responseImageContainer.innerHTML = '';
        if(responseImage && responseImage.length>50){ const img = document.createElement('img'); img.alt='Returned image'; img.style.maxWidth='100%'; img.style.maxHeight='100%'; img.style.borderRadius='8px'; img.src='data:image/jpeg;base64,'+responseImage; responseImageContainer.appendChild(img); }
      }

      function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
      resetPreview(); window.addEventListener('beforeunload', ()=>stopCamera());
    })();
  </script>
</body>
</html>
